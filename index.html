<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ChatBot UI - GPT-4o, 웹 검색, 이미지 생성</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .feature {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .feature-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .feature-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .feature-desc {
            font-size: 0.9rem;
            color: #666;
        }
        
        .api-key-section {
            margin: 30px 0;
        }
        
        .api-key-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        
        .api-key-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .start-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .start-btn:hover {
            transform: translateY(-2px);
        }
        
        .start-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .github-link {
            margin-top: 30px;
        }
        
        .github-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
        }
        
        .github-link a:hover {
            text-decoration: underline;
        }
        
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">🤖 AI ChatBot UI</div>
        <div class="subtitle">
            GPT-4o, 웹 검색, 이미지 생성이 통합된 올인원 AI 어시스턴트
        </div>
        
        <div class="features">
            <div class="feature">
                <div class="feature-icon">🧠</div>
                <div class="feature-title">GPT-4o 대화</div>
                <div class="feature-desc">자연스러운 한국어/영어 대화</div>
            </div>
            <div class="feature">
                <div class="feature-icon">🎨</div>
                <div class="feature-title">이미지 생성</div>
                <div class="feature-desc">DALL-E 3으로 고품질 이미지</div>
            </div>
            <div class="feature">
                <div class="feature-icon">🔍</div>
                <div class="feature-title">웹 검색</div>
                <div class="feature-desc">실시간 정보 검색</div>
            </div>
        </div>
        
        <div class="api-key-section">
            <input type="password" 
                   class="api-key-input" 
                   id="apiKey" 
                   placeholder="OpenAI API 키를 입력하세요 (sk-...)"
                   autocomplete="off">
            <button class="start-btn" id="startBtn" onclick="validateAndStart()">
                채팅 시작하기
            </button>
        </div>
        
        <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #28a745;">
            <h4 style="margin: 0 0 10px 0; color: #28a745;">🔍 검색 기능</h4>
            <p style="margin: 0 0 10px 0; font-size: 14px; color: #6c757d;">
                실시간 웹 검색을 통해 최신 정보를 제공합니다. 검색 버튼을 눌러보세요!
            </p>
        </div>
        
        <div class="status" id="status"></div>
        
        <div class="github-link">
            <a href="https://github.com/muniv/chatgpt_test" target="_blank">
                📁 GitHub 저장소 보기
            </a>
        </div>
    </div>

    <script>
        const apiKeyInput = document.getElementById('apiKey');
        const startBtn = document.getElementById('startBtn');
        const status = document.getElementById('status');
        
        // API 키 입력 시 버튼 활성화/비활성화
        apiKeyInput.addEventListener('input', function() {
            startBtn.disabled = !this.value.trim();
        });
        
        // Enter 키로 시작
        apiKeyInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim()) {
                validateAndStart();
            }
        });
        
        async function validateAndStart() {
            const apiKey = apiKeyInput.value.trim();
            
            if (!apiKey) {
                showStatus('API 키를 입력해주세요.', 'error');
                return;
            }
            
            if (!apiKey.startsWith('sk-')) {
                showStatus('올바른 OpenAI API 키 형식이 아닙니다.', 'error');
                return;
            }
            
            startBtn.disabled = true;
            startBtn.textContent = '검증 중...';
            
            try {
                // API 키 유효성 검사
                const response = await fetch('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });
                
                if (response.ok) {
                    // API 키를 localStorage에 저장
                    localStorage.setItem('openai_api_key', apiKey);
                    showStatus('API 키가 유효합니다! 채팅을 시작합니다...', 'success');
                    
                    // 간단한 채팅 인터페이스로 이동
                    setTimeout(() => {
                        startChat(apiKey);
                    }, 1000);
                } else {
                    showStatus('유효하지 않은 API 키입니다. 다시 확인해주세요.', 'error');
                }
            } catch (error) {
                showStatus('API 키 검증 중 오류가 발생했습니다.', 'error');
            } finally {
                startBtn.disabled = false;
                startBtn.textContent = '채팅 시작하기';
            }
        }
        
        function showStatus(message, type) {
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }
        
                 // 대화 히스토리 저장
         let conversationHistory = [
             {
                 role: 'system',
                 content: '당신은 도움이 되고 친근한 AI 어시스턴트입니다. 한국어로 답변해주세요.'
             },
             {
                 role: 'assistant',
                 content: '안녕하세요! API 키로 인증되었습니다. 무엇을 도와드릴까요?'
             }
         ];
         
         // 대화 히스토리 길이 제한 (최대 20개 메시지)
         function limitConversationHistory() {
             const maxMessages = 20;
             if (conversationHistory.length > maxMessages) {
                 // system 메시지와 첫 번째 assistant 메시지는 유지
                 const systemMessage = conversationHistory[0];
                 const firstAssistantMessage = conversationHistory[1];
                 const recentMessages = conversationHistory.slice(-(maxMessages - 2));
                 conversationHistory = [systemMessage, firstAssistantMessage, ...recentMessages];
             }
         }
         
         function startChat(apiKey) {
             // 간단한 채팅 인터페이스 생성
             const container = document.querySelector('.container');
             container.innerHTML = `
                 <div class="logo">💬 AI 채팅</div>
                 <div style="text-align: left; margin: 20px 0;">
                     <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                         <strong>AI:</strong> 안녕하세요! API 키로 인증되었습니다. 무엇을 도와드릴까요?
                     </div>
                 </div>
                 <div style="display: flex; gap: 10px;">
                     <input type="text" 
                            id="messageInput" 
                            placeholder="메시지를 입력하세요..."
                            style="flex: 1; padding: 10px; border: 2px solid #e9ecef; border-radius: 5px;">
                     <button onclick="sendMessage()" 
                             style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                         전송
                     </button>
                     <button onclick="searchAndChat()" 
                             style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                         🔍 검색
                     </button>
                 </div>
                 <div id="chatMessages" style="text-align: left; margin-top: 20px; max-height: 300px; overflow-y: auto;"></div>
                 <button onclick="location.reload()" 
                         style="margin-top: 20px; padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                     처음으로 돌아가기
                 </button>
             `;
             
             // 메시지 입력 이벤트
             const messageInput = document.getElementById('messageInput');
             messageInput.addEventListener('keypress', function(e) {
                 if (e.key === 'Enter') {
                     sendMessage();
                 }
             });
         }
        
                 async function sendMessage() {
             const messageInput = document.getElementById('messageInput');
             const chatMessages = document.getElementById('chatMessages');
             const message = messageInput.value.trim();
             
             if (!message) return;
             
             const apiKey = localStorage.getItem('openai_api_key');
             
             // 사용자 메시지를 대화 히스토리에 추가
             conversationHistory.push({
                 role: 'user',
                 content: message
             });
             
             // 사용자 메시지 표시
             chatMessages.innerHTML += `
                 <div style="background: #e3f2fd; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                     <strong>사용자:</strong> ${message}
                 </div>
             `;
             
             messageInput.value = '';
             messageInput.disabled = true;
             
             // 이미지 생성 키워드 감지 (더 정확하게)
             const imageKeywords = ['그려줘', '그려', '그려봐', 'draw', 'generate'];
             const hasImageKeyword = imageKeywords.some(keyword => 
                 message.toLowerCase().includes(keyword.toLowerCase())
             );
             
             console.log('메시지:', message);
             console.log('이미지 키워드 감지:', hasImageKeyword);
             
             try {
                 if (hasImageKeyword) {
                     console.log('이미지 생성 시작');
                     // 이미지 생성
                     await generateImage(message, apiKey, chatMessages);
                 } else {
                     console.log('텍스트 응답 시작');
                     // 일반 대화
                     await generateTextResponse(message, apiKey, chatMessages);
                 }
             } catch (error) {
                 console.error('오류:', error);
                 chatMessages.innerHTML += `
                     <div style="background: #f8d7da; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                         <strong>오류:</strong> 메시지 전송 중 오류가 발생했습니다: ${error.message}
                     </div>
                 `;
             } finally {
                 messageInput.disabled = false;
                 messageInput.focus();
                 chatMessages.scrollTop = chatMessages.scrollHeight;
             }
         }
         
         async function generateTextResponse(message, apiKey, chatMessages) {
             const response = await fetch('https://api.openai.com/v1/chat/completions', {
                 method: 'POST',
                 headers: {
                     'Content-Type': 'application/json',
                     'Authorization': `Bearer ${apiKey}`
                 },
                 body: JSON.stringify({
                     model: 'gpt-4o',
                     messages: conversationHistory,
                     max_tokens: 1000,
                     temperature: 0.7
                 })
             });
             
             if (response.ok) {
                 const data = await response.json();
                 const aiResponse = data.choices[0].message.content;
                 
                 // AI 응답을 대화 히스토리에 추가
                 conversationHistory.push({
                     role: 'assistant',
                     content: aiResponse
                 });
                 
                 // 대화 히스토리 길이 제한
                 limitConversationHistory();
                 
                 chatMessages.innerHTML += `
                     <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                         <strong>AI:</strong> ${aiResponse}
                     </div>
                 `;
             } else {
                 throw new Error('텍스트 생성 실패');
             }
         }
         
         async function generateImage(message, apiKey, chatMessages) {
             console.log('이미지 생성 함수 시작:', message);
             
             // 이미지 생성 중 표시
             chatMessages.innerHTML += `
                 <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                     <strong>AI:</strong> 🎨 이미지를 생성하고 있습니다...
                 </div>
             `;
             
             // 프롬프트에서 이미지 키워드 제거하고 실제 내용만 추출
             let prompt = message;
             const imageKeywords = ['그려줘', '그려', '그려봐'];
             imageKeywords.forEach(keyword => {
                 prompt = prompt.replace(new RegExp(keyword, 'gi'), '').trim();
             });
             
             // 이전 대화 내용을 바탕으로 프롬프트 개선
             let enhancedPrompt = prompt;
             
             // 대화 히스토리에서 관련 내용 추출
             const recentMessages = conversationHistory.slice(-6); // 최근 6개 메시지 확인
             const contextMessages = recentMessages.filter(msg => 
                 msg.role === 'user' && 
                 !imageKeywords.some(keyword => msg.content.toLowerCase().includes(keyword.toLowerCase()))
             );
             
             if (contextMessages.length > 0) {
                 // 이전 대화 내용을 프롬프트에 추가
                 const contextText = contextMessages.map(msg => msg.content).join(' ');
                 enhancedPrompt = `${contextText} ${prompt}`;
                 console.log('대화 컨텍스트 포함된 프롬프트:', enhancedPrompt);
             }
             
             console.log('추출된 프롬프트:', prompt);
             
             // 한국어를 영어로 번역 (간단한 매핑)
             const translations = {
                 '고양이': 'cat',
                 '강아지': 'dog',
                 '사람': 'person',
                 '풍경': 'landscape',
                 '꽃': 'flower',
                 '나무': 'tree',
                 '하늘': 'sky',
                 '바다': 'ocean',
                 '산': 'mountain',
                 '집': 'house',
                 '자동차': 'car',
                 '비행기': 'airplane',
                 '배': 'ship',
                 '책': 'book',
                 '컴퓨터': 'computer',
                 '전화': 'phone',
                 '음식': 'food',
                 '음악': 'music',
                 '운동': 'exercise',
                 '게임': 'game'
             };
             
             // 번역 적용
             let englishPrompt = enhancedPrompt;
             Object.keys(translations).forEach(korean => {
                 englishPrompt = englishPrompt.replace(new RegExp(korean, 'g'), translations[korean]);
             });
             
             // 영어 프롬프트가 비어있으면 원본 사용
             if (!englishPrompt.trim()) {
                 englishPrompt = enhancedPrompt;
             }
             
             console.log('영어 프롬프트:', englishPrompt);
             
             try {
                 // DALL-E API 호출
                 const apiResponse = await fetch('https://api.openai.com/v1/images/generations', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                         'Authorization': `Bearer ${apiKey}`
                     },
                     body: JSON.stringify({
                         model: 'dall-e-3',
                         prompt: englishPrompt + ' (high quality, detailed, beautiful)',
                         n: 1,
                         size: '1024x1024'
                     })
                 });
                 
                 console.log('DALL-E API 응답 상태:', apiResponse.status);
                 
                 if (apiResponse.ok) {
                     const imageData = await apiResponse.json();
                     console.log('이미지 데이터:', imageData);
                     
                     const imageUrl = imageData.data[0].url;
                     
                     // 기존 "생성 중" 메시지 제거
                     const lastMessage = chatMessages.lastElementChild;
                     if (lastMessage && lastMessage.textContent.includes('이미지를 생성하고 있습니다')) {
                         lastMessage.remove();
                     }
                     
                     // AI 응답을 대화 히스토리에 추가
                     const imageResponseText = `🎨 "${enhancedPrompt}"에 대한 이미지를 생성했습니다!`;
                     conversationHistory.push({
                         role: 'assistant',
                         content: imageResponseText
                     });
                     
                     // 대화 히스토리 길이 제한
                     limitConversationHistory();
                     
                     // 생성된 이미지 표시
                     chatMessages.innerHTML += `
                         <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 10px;">
                             <strong>AI:</strong> 🎨 "${enhancedPrompt}"에 대한 이미지를 생성했습니다!<br><br>
                             <img src="${imageUrl}" alt="AI 생성 이미지" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                         </div>
                     `;
                 } else {
                     const errorData = await apiResponse.json();
                     console.error('DALL-E API 오류:', errorData);
                     throw new Error(`이미지 생성 실패: ${errorData.error?.message || '알 수 없는 오류'}`);
                 }
             } catch (error) {
                 console.error('이미지 생성 중 오류:', error);
                 
                 // 기존 "생성 중" 메시지 제거
                 const lastMessage = chatMessages.lastElementChild;
                 if (lastMessage && lastMessage.textContent.includes('이미지를 생성하고 있습니다')) {
                     lastMessage.remove();
                 }
                 
                 // 오류 메시지 표시
                 chatMessages.innerHTML += `
                     <div style="background: #f8d7da; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                         <strong>오류:</strong> 이미지 생성 중 오류가 발생했습니다: ${error.message}
                     </div>
                 `;
             }
                  }
         
         // 검색 기능
         async function searchAndChat() {
             const messageInput = document.getElementById('messageInput');
             const chatMessages = document.getElementById('chatMessages');
             const message = messageInput.value.trim();
             
             if (!message) {
                 alert('검색할 내용을 입력해주세요!');
                 return;
             }
             
             const apiKey = localStorage.getItem('openai_api_key');
             
             // 사용자 메시지를 대화 히스토리에 추가
             conversationHistory.push({
                 role: 'user',
                 content: `🔍 ${message} (검색 요청)`
             });
             
             // 사용자 메시지 표시
             chatMessages.innerHTML += `
                 <div style="background: #e3f2fd; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                     <strong>사용자:</strong> 🔍 ${message} (검색 요청)
                 </div>
             `;
             
             messageInput.value = '';
             messageInput.disabled = true;
             
             try {
                 // 검색 중 표시
                 chatMessages.innerHTML += `
                     <div style="background: #fff3cd; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                         <strong>AI:</strong> 🔍 웹에서 "${message}"에 대한 정보를 검색하고 있습니다...
                     </div>
                 `;
                 
                 // 웹 검색 수행 (SerpAPI 사용)
                 const searchResults = await performWebSearch(message);
                 
                 // 검색 결과를 바탕으로 AI 응답 생성
                 await generateSearchResponse(message, searchResults, apiKey, chatMessages);
                 
             } catch (error) {
                 console.error('검색 오류:', error);
                 
                 // 기존 "검색 중" 메시지 제거
                 const lastMessage = chatMessages.lastElementChild;
                 if (lastMessage && lastMessage.textContent.includes('검색하고 있습니다')) {
                     lastMessage.remove();
                 }
                 
                 chatMessages.innerHTML += `
                     <div style="background: #f8d7da; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                         <strong>오류:</strong> 검색 중 오류가 발생했습니다: ${error.message}
                     </div>
                 `;
             } finally {
                 messageInput.disabled = false;
                 messageInput.focus();
                 chatMessages.scrollTop = chatMessages.scrollHeight;
             }
         }
         

         
         // 웹 검색 수행
         async function performWebSearch(query) {
             console.log('검색 쿼리:', query);
             
             // 고정된 SerpAPI 키 사용
             const serpApiKey = '58916791d803e313587e30c1a529acd6e64b9fd6e51104459425eeae6c576bf2';
             
             // 실제 SerpAPI 사용
             try {
                 const response = await fetch(`https://serpapi.com/search.json?engine=google&q=${encodeURIComponent(query)}&api_key=${serpApiKey}&num=5`);
                 
                 if (response.ok) {
                     const data = await response.json();
                     console.log('SerpAPI 검색 결과:', data);
                     
                     if (data.organic_results && data.organic_results.length > 0) {
                         return data.organic_results.slice(0, 5).map(result => ({
                             title: result.title,
                             snippet: result.snippet,
                             link: result.link
                         }));
                     }
                 } else {
                     console.error('SerpAPI 오류:', response.status);
                     const errorData = await response.json();
                     console.error('SerpAPI 오류 상세:', errorData);
                 }
             } catch (error) {
                 console.error('SerpAPI 호출 오류:', error);
             }
             
             // SerpAPI 오류 발생 시 시뮬레이션된 결과 반환
             const mockSearchResults = [
                 {
                     title: `${query}에 대한 최신 정보`,
                     snippet: `${query}에 대한 상세한 정보와 최신 동향을 확인할 수 있습니다.`,
                     link: `https://www.google.com/search?q=${encodeURIComponent(query)}`
                 },
                 {
                     title: `${query} 관련 뉴스`,
                     snippet: `${query}와 관련된 최신 뉴스와 업데이트 정보입니다.`,
                     link: `https://news.google.com/search?q=${encodeURIComponent(query)}`
                 },
                 {
                     title: `${query} 전문 자료`,
                     snippet: `${query}에 대한 전문적인 분석과 자료를 제공합니다.`,
                     link: `https://scholar.google.com/scholar?q=${encodeURIComponent(query)}`
                 }
             ];
             
             return mockSearchResults;
         }
         
         // 검색 결과를 바탕으로 AI 응답 생성
         async function generateSearchResponse(query, searchResults, apiKey, chatMessages) {
             // 검색 결과를 텍스트로 변환
             const searchText = searchResults.map((result, index) => 
                 `${index + 1}. ${result.title}\n   ${result.snippet}\n   링크: ${result.link}`
             ).join('\n\n');
             
             // 기존 "검색 중" 메시지 제거
             const lastMessage = chatMessages.lastElementChild;
             if (lastMessage && lastMessage.textContent.includes('검색하고 있습니다')) {
                 lastMessage.remove();
             }
             
             try {
                 const response = await fetch('https://api.openai.com/v1/chat/completions', {
                     method: 'POST',
                     headers: {
                         'Content-Type': 'application/json',
                         'Authorization': `Bearer ${apiKey}`
                     },
                     body: JSON.stringify({
                         model: 'gpt-4o',
                         messages: [
                             {
                                 role: 'system',
                                 content: `당신은 웹 검색 결과를 바탕으로 도움이 되는 답변을 제공하는 AI 어시스턴트입니다. 
                                 검색 결과를 요약하고, 사용자의 질문에 대한 답변을 제공하세요. 
                                 한국어로 답변하고, 검색 결과의 출처를 언급하세요.`
                             },
                             {
                                 role: 'user',
                                 content: `다음은 "${query}"에 대한 웹 검색 결과입니다:\n\n${searchText}\n\n이 정보를 바탕으로 "${query}"에 대해 자세히 설명해주세요.`
                             }
                         ],
                         max_tokens: 1500,
                         temperature: 0.7
                     })
                 });
                 
                 if (response.ok) {
                     const data = await response.json();
                     const aiResponse = data.choices[0].message.content;
                     
                     // AI 응답을 대화 히스토리에 추가
                     conversationHistory.push({
                         role: 'assistant',
                         content: `🔍 "${query}"에 대한 검색 결과를 바탕으로 답변드립니다:\n\n${aiResponse}`
                     });
                     
                     // 대화 히스토리 길이 제한
                     limitConversationHistory();
                     
                     chatMessages.innerHTML += `
                         <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 10px;">
                             <strong>AI:</strong> 🔍 "${query}"에 대한 검색 결과를 바탕으로 답변드립니다:<br><br>
                             ${aiResponse.replace(/\n/g, '<br>')}
                         </div>
                     `;
                 } else {
                     throw new Error('AI 응답 생성 실패');
                 }
             } catch (error) {
                 console.error('AI 응답 생성 오류:', error);
                 
                 // 검색 결과만 표시
                 chatMessages.innerHTML += `
                     <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 10px;">
                         <strong>AI:</strong> 🔍 "${query}"에 대한 검색 결과입니다:<br><br>
                         ${searchResults.map((result, index) => 
                             `<strong>${index + 1}. ${result.title}</strong><br>
                             ${result.snippet}<br>
                             <a href="${result.link}" target="_blank" style="color: #667eea;">링크 보기</a><br><br>`
                         ).join('')}
                     </div>
                 `;
             }
         }
     </script>
</body>
</html> 